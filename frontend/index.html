<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Terraforming Mars - Scoreboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Socket.IO Client - Î°úÏª¨ ÌååÏùº Ïö∞ÏÑ†, CDN ÎåÄÏ≤¥ -->
    <script>
        // Socket.IO Î°úÎî© ÏãúÎèÑ
        (function() {
            // 1. Î°úÏª¨ ÌååÏùº ÏãúÎèÑ
            var localScript = document.createElement('script');
            localScript.src = 'socket.io.min.js';
            localScript.onerror = function() {
                console.log('Local Socket.IO not found, trying CDN...');
                // 2. CDN ÏãúÎèÑ
                var cdnScript = document.createElement('script');
                cdnScript.src = 'https://cdn.jsdelivr.net/npm/socket.io-client@4.7.2/dist/socket.io.min.js';
                cdnScript.onerror = function() {
                    console.log('Primary CDN failed, trying backup...');
                    // 3. Î∞±ÏóÖ CDN ÏãúÎèÑ
                    var backupScript = document.createElement('script');
                    backupScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js';
                    backupScript.onerror = function() {
                        console.error('All Socket.IO sources failed!');
                    };
                    document.head.appendChild(backupScript);
                };
                document.head.appendChild(cdnScript);
            };
            document.head.appendChild(localScript);
        })();
    </script>
    <div id="app">
        <!-- ÎîîÎ≤ÑÍ∑∏ Ìå®ÎÑê (Î™®Î∞îÏùºÏö©) -->
        <div class="debug-panel" v-if="showDebugPanel">
            <div style="background: #000; color: #0f0; padding: 10px; font-size: 12px; max-height: 200px; overflow-y: auto;">
                <div><strong>üîç Debug Info</strong></div>
                <div>Socket.IO Loaded: {{ socketIoLoaded ? '‚úÖ' : '‚ùå' }}</div>
                <div>Socket Status: {{ socketStatus }}</div>
                <div>Socket ID: {{ socketId || 'Not connected' }}</div>
                <div>URL: {{ currentUrl }}</div>
                <div>---</div>
                <div v-for="(log, index) in debugLogs" :key="index" style="font-size: 10px;">
                    {{ log }}
                </div>
            </div>
            <button @click="showDebugPanel = false" style="width: 100%; padding: 5px; background: #f00; color: #fff;">Close Debug</button>
        </div>

        <!-- Í≥ÑÏÇ∞Í∏∞ Î™®Îã¨ -->
        <calculator-modal
            :show="showCalculator"
            :resource="calculatorData.resource"
            :current-value="calculatorData.currentValue"
            @close="closeCalculator"
            @spend="handleSpend"
            @gain="handleGain"
        ></calculator-modal>

        <!-- Í≤åÏûÑ ÏÑ§Ï†ï -->
        <div class="game-settings">
            <button @click="showDebugPanel = !showDebugPanel" style="background: #333; color: #0f0;">üêõ Debug</button>
            <button @click="resetGame">New Game</button>
            <label>
                Players:
                <select v-model.number="playerCount" @change="updatePlayerCount">
                    <option :value="1">1 Player</option>
                    <option :value="2">2 Players</option>
                </select>
            </label>
            <div class="generation-control">
                <label>Generation: <span class="generation-value">{{ currentGeneration }}</span></label>
                <button class="next-generation-btn" @click="nextGeneration">‚Üí</button>
            </div>
        </div>

        <!-- Í≤åÏûÑ Î≥¥Îìú -->
        <div class="game-container" :class="{ 'two-players': playerCount === 2 }">
            <!-- Player 1 -->
            <div class="player-board">
                <div class="player-board-header">
                    <h2 v-if="playerCount === 2">
                        <span v-if="editingPlayerName !== 'player1'"
                              class="player-name"
                              @click="startEditingPlayerName('player1')">
                            {{ gameState.player1.name }}
                        </span>
                        <input v-else
                               v-model="editingNameValue"
                               @keyup.enter="savePlayerName('player1')"
                               @keyup.esc="cancelEditingPlayerName"
                               @blur="savePlayerName('player1')"
                               class="player-name-input"
                               autofocus>
                    </h2>
                    <h2 v-else>&nbsp;</h2>
                    <button
                        class="undo-button"
                        @click="undoPlayerAction('player1')"
                        :disabled="playerHistory.player1.length === 0"
                        title="Undo last action">
                        ‚Ü∫
                    </button>
                </div>

                <!-- ÏÉÅÎã® Ïª®Ìä∏Î°§ -->
                <div class="top-controls">
                    <div class="control-group">
                        <label>Terraforming Rating</label>
                        <div class="counter">
                            <button @click="updateRating('player1', -1)">‚àí</button>
                            <span class="value">{{ gameState.player1.terraformingRating }}</span>
                            <button @click="updateRating('player1', 1)">+</button>
                        </div>
                    </div>
                </div>

                <!-- Î¶¨ÏÜåÏä§ Ïπ¥Îìú -->
                <div class="resources-grid">
                    <resource-card
                        v-for="resource in resources"
                        :key="resource.type"
                        :resource="resource"
                        :player-data="gameState.player1[resource.type]"
                        :player-id="'player1'"
                        @update="updateResource('player1', resource.type, $event)"
                        @open-calculator="openCalculator"
                    ></resource-card>
                </div>
            </div>

            <!-- Player 2 (2Ïù∏ ÌîåÎ†àÏù¥Ïãú) -->
            <div class="player-board" v-if="playerCount === 2">
                <div class="player-board-header">
                    <h2>
                        <span v-if="editingPlayerName !== 'player2'"
                              class="player-name"
                              @click="startEditingPlayerName('player2')">
                            {{ gameState.player2.name }}
                        </span>
                        <input v-else
                               v-model="editingNameValue"
                               @keyup.enter="savePlayerName('player2')"
                               @keyup.esc="cancelEditingPlayerName"
                               @blur="savePlayerName('player2')"
                               class="player-name-input"
                               autofocus>
                    </h2>
                    <button
                        class="undo-button"
                        @click="undoPlayerAction('player2')"
                        :disabled="playerHistory.player2.length === 0"
                        title="Undo last action">
                        ‚Ü∫
                    </button>
                </div>

                <!-- ÏÉÅÎã® Ïª®Ìä∏Î°§ -->
                <div class="top-controls">
                    <div class="control-group">
                        <label>Terraforming Rating</label>
                        <div class="counter">
                            <button @click="updateRating('player2', -1)">‚àí</button>
                            <span class="value">{{ gameState.player2.terraformingRating }}</span>
                            <button @click="updateRating('player2', 1)">+</button>
                        </div>
                    </div>
                </div>

                <!-- Î¶¨ÏÜåÏä§ Ïπ¥Îìú -->
                <div class="resources-grid">
                    <resource-card
                        v-for="resource in resources"
                        :key="resource.type"
                        :resource="resource"
                        :player-data="gameState.player2[resource.type]"
                        :player-id="'player2'"
                        @update="updateResource('player2', resource.type, $event)"
                        @open-calculator="openCalculator"
                    ></resource-card>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="main.js"></script>
</body>
</html>
